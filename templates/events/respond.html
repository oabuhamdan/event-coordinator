{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Respond to {{ event.title }} - Event Coordinator{% endblock %}

{% block extra_css %}
<style>
.response-container {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 20px;
    padding: 2rem;
}

.response-option {
    border: 2px solid transparent;
    transition: all 0.3s ease;
    cursor: pointer;
    border-radius: 15px;
}

.response-option:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
}

.response-option.selected {
    border-color: #007bff;
    background: rgba(0,123,255,0.1);
}

.event-info {
    background: white;
    border-radius: 15px;
    padding: 1.5rem;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    margin-bottom: 2rem;
}
</style>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="response-container">
            <!-- Header -->
            <div class="text-center mb-4">
                <i class="fas fa-reply fa-3x text-primary mb-3"></i>
                <h2 class="fw-bold">Respond to Event</h2>
                <p class="text-muted">Let the organizer know if you'll be attending</p>
            </div>

            <!-- Event Info -->
            <div class="event-info">
                <h4 class="fw-bold mb-3">{{ event.title }}</h4>
                <div class="row">
                    <div class="col-md-6">
                        <p><i class="fas fa-calendar me-2 text-primary"></i><strong>Date:</strong><br>{{ event.date_time|date:"F j, Y" }}</p>
                        <p><i class="fas fa-building me-2 text-primary"></i><strong>Organization:</strong><br>{{ event.organization.name }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><i class="fas fa-clock me-2 text-primary"></i><strong>Time:</strong><br>{{ event.date_time|time:"g:i A" }}</p>
                        {% if event.location %}
                        <p><i class="fas fa-map-marker-alt me-2 text-primary"></i><strong>Location:</strong><br>{{ event.location }}</p>
                        {% endif %}
                    </div>
                </div>
                {% if event.description %}
                <p class="mt-3"><i class="fas fa-info-circle me-2 text-primary"></i><strong>Description:</strong><br>{{ event.description }}</p>
                {% endif %}
            </div>

            <!-- Response Options -->
            <form method="post" id="responseForm">
                {% csrf_token %}
                {{ form|crispy }}

                <div class="row g-3 mb-4">
                    <div class="col-md-4">
                        <div class="response-option card text-center h-100" data-response="yes">
                            <div class="card-body">
                                <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                                <h5 class="card-title">Yes, I'll attend</h5>
                                <p class="card-text text-muted">Count me in!</p>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="response-option card text-center h-100" data-response="maybe">
                            <div class="card-body">
                                <i class="fas fa-question-circle fa-3x text-warning mb-3"></i>
                                <h5 class="card-title">Maybe</h5>
                                <p class="card-text text-muted">I'm not sure yet</p>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="response-option card text-center h-100" data-response="no">
                            <div class="card-body">
                                <i class="fas fa-times-circle fa-3x text-danger mb-3"></i>
                                <h5 class="card-title">No, can't attend</h5>
                                <p class="card-text text-muted">Sorry, not available</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="text-center">
                    <button type="submit" class="btn btn-primary btn-lg me-3" id="submitBtn" disabled>
                        <i class="fas fa-paper-plane me-2"></i>Submit Response
                    </button>
                    <a href="{% url 'events:detail' pk=event.id %}" class="btn btn-outline-secondary btn-lg">
                        <i class="fas fa-arrow-left me-2"></i>Back to Event
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const responseOptions = document.querySelectorAll('.response-option');
    const submitBtn = document.getElementById('submitBtn');
    const form = document.getElementById('responseForm');
    let selectedResponse = null;

    responseOptions.forEach(option => {
        option.addEventListener('click', function() {
            // Remove selected class from all options
            responseOptions.forEach(opt => opt.classList.remove('selected'));

            // Add selected class to clicked option
            this.classList.add('selected');
            
            // Get response value
            selectedResponse = this.dataset.response;

            // Enable submit button
            submitBtn.disabled = false;

            // Update form field if it exists
            const responseField = document.querySelector('input[name="response"], select[name="response"]');
            if (responseField) {
                responseField.value = selectedResponse;
            }
        });
    });

    form.addEventListener('submit', function(e) {
        if (!selectedResponse) {
            e.preventDefault();
            alert('Please select a response option');
            return;
        }

        // Add hidden input with response value
        const hiddenInput = document.createElement('input');
        hiddenInput.type = 'hidden';
        hiddenInput.name = 'response';
        hiddenInput.value = selectedResponse;
        form.appendChild(hiddenInput);

        showLoading();
    });
});
</script>
{% endblock %}